# Custom SQL queries for PostgreSQL with schema-aware functions
# High-performance multi-tenant queries using PostgreSQL functions
# Functions automatically determine correct tenant schema

authorize_check_query = "\
	SELECT id, username, attribute, value, op \
	FROM public.radius_authorize_check('%{SQL-User-Name}')"

authorize_reply_query = "\
	SELECT id, username, attribute, value, op \
	FROM public.radius_authorize_reply('%{SQL-User-Name}')"

# Group queries disabled - not using groups
#authorize_group_check_query = ""
#authorize_group_reply_query = ""

group_membership_query = ""

accounting_onoff_query = "\
	SELECT radius_accounting_onoff( \
		'%{NAS-IP-Address}', \
		%{integer:Event-Timestamp}, \
		'%{%{Acct-Terminate-Cause}:-NAS-Reboot}', \
		%{%{Acct-Delay-Time}:-0} \
	)"

accounting_update_query = "\
	SELECT radius_accounting_update( \
		'%{SQL-User-Name}', \
		'%{Acct-Unique-Session-Id}', \
		'%{Framed-IP-Address}', \
		%{%{Acct-Session-Time}:-NULL}, \
		(('%{%{Acct-Input-Gigawords}:-0}'::bigint << 32) + '%{%{Acct-Input-Octets}:-0}'::bigint), \
		(('%{%{Acct-Output-Gigawords}:-0}'::bigint << 32) + '%{%{Acct-Output-Octets}:-0}'::bigint) \
	)"

accounting_start_query = "\
	SELECT radius_accounting_start( \
		'%{Acct-Session-Id}', \
		'%{Acct-Unique-Session-Id}', \
		'%{SQL-User-Name}', \
		'%{Realm}', \
		'%{%{NAS-IPv6-Address}:-%{NAS-IP-Address}}', \
		'%{%{NAS-Port-ID}:-%{NAS-Port}}', \
		%{integer:Event-Timestamp}, \
		'%{Acct-Authentic}', \
		'%{Connect-Info}', \
		'%{Called-Station-Id}', \
		'%{Calling-Station-Id}', \
		'%{Service-Type}', \
		'%{Framed-Protocol}', \
		'%{Framed-IP-Address}' \
	)"

accounting_stop_query = "\
	SELECT radius_accounting_stop( \
		'%{SQL-User-Name}', \
		'%{Acct-Unique-Session-Id}', \
		%{integer:Event-Timestamp}, \
		%{%{Acct-Session-Time}:-NULL}, \
		(('%{%{Acct-Input-Gigawords}:-0}'::bigint << 32) + '%{%{Acct-Input-Octets}:-0}'::bigint), \
		(('%{%{Acct-Output-Gigawords}:-0}'::bigint << 32) + '%{%{Acct-Output-Octets}:-0}'::bigint), \
		'%{Acct-Terminate-Cause}', \
		'%{Connect-Info}' \
	)"

postauth_query = "\
	SELECT public.radius_post_auth_insert( \
		'%{User-Name}', \
		'%{%{User-Password}:-%{Chap-Password}}', \
		'%{reply:Packet-Type}' \
	)"
