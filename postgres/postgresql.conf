# ============================================================================
# PostgreSQL Configuration for WiFi Hotspot Multi-Tenant System
# ============================================================================
# This file contains custom PostgreSQL settings optimized for:
# - Multi-tenancy with schema-based isolation
# - High connection count (100K+ potential tenants)
# - Query performance monitoring
# - RADIUS authentication workload
# ============================================================================

# ----------------------------------------------------------------------------
# EXTENSIONS
# ----------------------------------------------------------------------------
# Load pg_stat_statements for query performance monitoring
shared_preload_libraries = 'pg_stat_statements'

# pg_stat_statements configuration
pg_stat_statements.max = 10000
pg_stat_statements.track = all

# ----------------------------------------------------------------------------
# CONNECTION SETTINGS
# ----------------------------------------------------------------------------
# Increased for multi-tenant environment
max_connections = 200
superuser_reserved_connections = 5

# ----------------------------------------------------------------------------
# MEMORY SETTINGS
# ----------------------------------------------------------------------------
# Optimized for container environment
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB

# ----------------------------------------------------------------------------
# QUERY PLANNING
# ----------------------------------------------------------------------------
# Optimize for multi-tenant queries
random_page_cost = 1.1  # SSD-optimized
effective_io_concurrency = 200

# ----------------------------------------------------------------------------
# WRITE AHEAD LOG (WAL)
# ----------------------------------------------------------------------------
# Balance between performance and durability
wal_buffers = 16MB
checkpoint_completion_target = 0.9
max_wal_size = 1GB
min_wal_size = 80MB

# ----------------------------------------------------------------------------
# LOGGING
# ----------------------------------------------------------------------------
# Log slow queries for optimization
log_min_duration_statement = 1000  # Log queries > 1 second
log_line_prefix = '%t [%p] %u@%d '
log_timezone = 'Africa/Nairobi'

# ----------------------------------------------------------------------------
# AUTOVACUUM
# ----------------------------------------------------------------------------
# Aggressive autovacuum for high-write workload
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 30s

# ----------------------------------------------------------------------------
# LOCALE AND FORMATTING
# ----------------------------------------------------------------------------
datestyle = 'iso, mdy'
timezone = 'Africa/Nairobi'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'

# ----------------------------------------------------------------------------
# STATEMENT TIMEOUT
# ----------------------------------------------------------------------------
# Prevent runaway queries
statement_timeout = 30000  # 30 seconds

# ----------------------------------------------------------------------------
# MULTI-TENANCY OPTIMIZATION
# ----------------------------------------------------------------------------
# Increase schema cache for multi-tenant workload
max_locks_per_transaction = 256  # Default is 64
